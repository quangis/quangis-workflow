@prefix : <https://github.com/quangis/transformation-algebra#>.
@prefix from: <https://github.com/quangis/transformation-algebra#from>.
@prefix type: <https://github.com/quangis/cct#type>.
@prefix via: <https://github.com/quangis/cct#operator>.

_:Roads
    type: "R(Obj, Reg * Nom)".
_:AdministrativeAreas
    type: "R(Obj, Reg * Nom)".
_:RegionalPopulationCounts
    type: "R(Obj, Reg * Count)".

[] a :Query;
    :question "What is the percentage of rural population within 2km distance to all-season roads in Shikoku, Japan?";
    :workflow <https://example.com/#InfrastructureAccessShikoku>;
    :input _:Roads, _:AdminstrativeAreas, _:RegionalPopulationCounts;
    :output [
        # Proportion of rural areas close to roads wrt total rural population
        type: "R(Reg, Ratio)"; # A
        from: [
            # Sum the total population amount in rural areas
            type: "R(Reg, Count)"; # B
            from: _:RuralPopulationCounts # C
        ];
        from: [
            # Content amounts for rural buffer areas by areal interpolation
            type: "R(Reg, Count)"; # G
            from: _:RuralPopulationCounts; # C
            from: [
                # Build a buffer around roads
                type: "R(Loc, Bool)"; # H
                from: _:Roads # I
            ]
        ]
    ].

_:RuralPopulationCounts
    # Clip population counts to rural areas
    type: "R(Obj, Reg * Count)"; # C
    from: _:RegionalPopulationCounts; # D
    from: [
        # Select rural administrative areas
        type: "R(Obj, Reg)"; # E
        from: _:AdministrativeAreas # F
    ].
